<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moto Partes El Jefe | Cat치logo Digital</title>
    <link rel="icon" href="logo.ico">

    <!-- 1. LIBRER칈AS (Tailwind, Fuentes, Iconos y Lector de Excel) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <style>
        :root { --bg-crema: #F3F0E9; --azul-brand: #0866BD; --rojo-accent: #dc2626; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-crema); color: #333; }
        .oswald { font-family: 'Oswald', sans-serif; }
        
        /* Navegaci칩n */
        .top-nav { background-color: var(--azul-brand); }
        .category-nav { background-color: white; border-bottom: 4px solid var(--azul-brand); position: sticky; top: 0; z-index: 40; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .nav-btn { position: relative; color: #555; font-weight: bold; text-transform: uppercase; padding: 15px 20px; transition: all 0.3s; cursor: pointer; font-family: 'Oswald', sans-serif; letter-spacing: 1px; }
        .nav-btn:hover { color: var(--azul-brand); background-color: #f8f8f8; }
        .nav-btn.active { color: var(--azul-brand); }
        .nav-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background-color: var(--rojo-accent); }

        /* Tarjetas de Producto */
        .product-card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; height: 100%; padding: 1rem; cursor: pointer; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: var(--azul-brand); }
        .card-content-grow { flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; margin-bottom: 1rem; }
        
        /* Utilidades */
        .line-clamp-1 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 1; }
        .hidden-section { display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .float-wa { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background-color: #25d366; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 2px 2px 10px rgba(0,0,0,0.3); z-index: 100; transition: transform 0.3s; }
        .float-wa:hover { transform: scale(1.1); }

        /* Modal */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; justify-content: center; align-items: center; backdrop-filter: blur(5px); padding: 20px; }
        .modal-active { display: flex !important; }
        .modal-list ul { list-style-type: none; padding-left: 0; }
        .modal-list li { margin-bottom: 6px; display: flex; align-items: center; color: #555; font-size: 0.95rem; }
        .modal-list li::before { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--green-500); margin-right: 8px; font-size: 0.8rem; }

        /* Tabla */
        .compat-table-container { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-top: 15px; }
        .compat-table-header { background-color: var(--azul-brand); color: white; padding: 10px 15px; font-weight: bold; font-family: 'Oswald', sans-serif; letter-spacing: 0.5px; display: flex; align-items: center; }
        .table-auto { width: 100%; text-align: left; border-collapse: collapse; font-size: 0.9rem; }
        .table-auto th { background-color: #e2e8f0; color: var(--azul-brand); padding: 8px 12px; }
        .table-auto td { padding: 8px 12px; border-bottom: 1px solid #eee; color: #4b5563; }
    </style>
</head>
<body class="mb-0">

    <!-- HEADER -->
    <header class="top-nav text-white py-4 md:py-6 shadow-md">
        <div class="max-w-7xl mx-auto px-4 flex justify-center items-center">
            <div class="flex items-center gap-3 md:gap-5">
                <img src="logo.png" alt="Logo El Jefe" class="h-16 md:h-20 w-auto bg-white rounded-full p-1 border-2 border-gray-300 shadow-md">
                <div class="text-left">
                    <h1 class="oswald text-2xl md:text-4xl font-bold uppercase tracking-widest leading-none">El Jefe</h1>
                    <p class="text-xs md:text-sm text-gray-300 tracking-[0.2em] uppercase mt-1">Moto Partes | Tonal치</p>
                </div>
            </div>  
        </div>
    </header>
    
    <!-- NAVEGACI칍N -->
    <nav class="category-nav">
        <div class="max-w-7xl mx-auto px-4 flex justify-start md:justify-center overflow-x-auto no-scrollbar py-1">
            <button onclick="switchTab('afinacion')" id="btn-afinacion" class="nav-btn active whitespace-nowrap flex-shrink-0"><i class="fas fa-oil-can mr-2"></i> Kits de Afinaci칩n</button>
            <button onclick="switchTab('sprocket')" id="btn-sprocket" class="nav-btn whitespace-nowrap flex-shrink-0"><i class="fas fa-cogs mr-2"></i> Kits de sprocket</button>        
            <button onclick="switchTab('llantas')" id="btn-llantas" class="nav-btn whitespace-nowrap flex-shrink-0"><i class="fas fa-bullseye mr-2"></i> Llantas</button>
            <button onclick="switchTab('refacciones')" id="btn-refacciones" class="nav-btn whitespace-nowrap flex-shrink-0"><i class="fas fa-wrench mr-2"></i> Refacciones</button>
            <button onclick="switchTab('accesorios')" id="btn-accesorios" class="nav-btn whitespace-nowrap flex-shrink-0"><i class="fas fa-helmet-safety mr-2"></i> Accesorios</button>
        </div>
    </nav>

    <!-- BUSCADOR -->
    <div class="bg-[#F3F0E9] py-3 px-4 sticky top-[60px] z-30 shadow-md border-b border-gray-200">
        <div class="max-w-2xl mx-auto relative">
            <input type="text" id="globalSearch" onkeyup="searchProducts()" placeholder="游댌 Escribe aqu칤 (Ej. 250Z, Balata, Bater칤a...)" class="w-full p-3 pl-12 rounded-full border border-gray-300 focus:outline-none focus:border-[#0866bd] focus:ring-2 focus:ring-[#0866bd]/50 shadow-inner text-lg">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl"></i>
        </div>
    </div>

    <!-- CARRUSEL AUTOM츼TICO -->
    <div id="hero-carousel" class="relative min-h-[450px] flex items-center justify-center text-center overflow-hidden shadow-lg group">
        <div id="carousel-bg" class="absolute inset-0 bg-cover bg-center bg-no-repeat transition-all duration-1000 transform scale-105" 
             style="background-image: url('https://image2url.com/r2/default/images/1771180121587-a9f05c2f-aec1-406e-ada3-903967edc3af.webp');">
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-[#0866bd]/90 via-[#1d3e68]/50 to-transparent"></div>
        <div class="relative z-10 px-4 max-w-4xl">
            <h2 id="carousel-title" class="oswald text-4xl md:text-6xl font-bold text-white uppercase mb-4 drop-shadow-lg tracking-wide transition-opacity duration-500">
                ESPECIALISTAS EN MOTOS
            </h2>
            <p id="carousel-text" class="text-gray-200 text-lg md:text-xl mb-8 font-light tracking-wider transition-opacity duration-500 delay-100">
                Refacciones para Italika, Bajaj, Vento y m치s
            </p>
            <a href="https://wa.me/523332406334" target="_blank" class="inline-block bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 md:px-12 rounded-full transition shadow-xl transform hover:scale-105 uppercase tracking-wider text-sm md:text-lg border-2 border-transparent hover:border-white">
                <i class="fab fa-whatsapp mr-2"></i> Cotizar Ahora
            </a>
        </div>
    </div>

    <!-- BENEFICIOS -->
    <section class="bg-white py-10 border-b border-gray-200 hidden md:block">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-center">
                <div class="group p-4 hover:bg-gray-50 rounded-lg transition duration-300">
                    <div class="w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center text-[#0866bd] text-2xl mb-4 group-hover:scale-110 transition"><i class="fas fa-motorcycle"></i></div>
                    <h3 class="font-bold text-gray-800 uppercase mb-2">Entregas en Tonal치</h3>
                </div>
                <div class="group p-4 hover:bg-gray-50 rounded-lg transition duration-300">
                    <div class="w-16 h-16 mx-auto bg-red-100 rounded-full flex items-center justify-center text-red-600 text-2xl mb-4 group-hover:scale-110 transition"><i class="fas fa-tools"></i></div>
                    <h3 class="font-bold text-gray-800 uppercase mb-2">Asesor칤a Experta</h3>
                </div>
                <div class="group p-4 hover:bg-gray-50 rounded-lg transition duration-300">
                    <div class="w-16 h-16 mx-auto bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600 text-2xl mb-4 group-hover:scale-110 transition"><i class="fas fa-shield-alt"></i></div>
                    <h3 class="font-bold text-gray-800 uppercase mb-2">Garant칤a de Calidad</h3>
                </div>
                <div class="group p-4 hover:bg-gray-50 rounded-lg transition duration-300">
                    <div class="w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center text-green-600 text-2xl mb-4 group-hover:scale-110 transition"><i class="fas fa-money-bill-wave"></i></div>
                    <h3 class="font-bold text-gray-800 uppercase mb-2">Precios Justos</h3>
                </div>
            </div>
        </div>
    </section>
    
    <!-- 츼REA DE PRODUCTOS DIN츼MICA (SE LLENA CON GOOGLE SHEETS) -->
    <main class="max-w-7xl mx-auto px-4 min-h-[600px] py-10 md:py-16">

        <section id="afinacion" class="product-section">
            <div class="flex items-center mb-8 border-b pb-3 border-gray-300">
                <div class="h-6 md:h-8 w-1 bg-red-600 mr-3"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-[#0866bd] oswald uppercase">Kits de Afinaci칩n</h2>
            </div>
            <!-- Grid Din치mico -->
            <div id="grid-afinacion" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8">
                <p class="text-gray-400 col-span-full text-center py-10 animate-pulse">Cargando inventario desde la base de datos...</p>
            </div>
        </section>

        <section id="sprocket" class="product-section hidden-section">
             <div class="flex items-center mb-8 border-b pb-3 border-gray-300"><div class="h-6 md:h-8 w-1 bg-yellow-500 mr-3"></div><h2 class="text-2xl md:text-3xl font-bold text-[#0866bd] oswald uppercase">Kits de Arrastre</h2></div>
             <div id="grid-sprocket" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"></div>
        </section>

        <section id="llantas" class="product-section hidden-section">
            <div class="flex items-center mb-8 border-b pb-3 border-gray-300"><div class="h-6 md:h-8 w-1 bg-black mr-3"></div><h2 class="text-2xl md:text-3xl font-bold text-[#0866bd] oswald uppercase">Llantas y C치maras</h2></div>
            <div id="grid-llantas" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"></div>
        </section>

        <section id="refacciones" class="product-section hidden-section">
            <div class="border-b border-gray-300 pb-4 mb-6">
                <div class="flex items-center mb-4"><div class="h-6 md:h-8 w-1 bg-blue-500 mr-3"></div><h2 class="text-2xl md:text-3xl font-bold text-[#0866bd] oswald uppercase">Refacciones Generales</h2></div>
                <button onclick="showRefaccionesHome()" id="btn-back-ref" class="hidden text-sm font-bold text-gray-500 hover:text-[#0866bd] mb-4"><i class="fas fa-arrow-left mr-2"></i> Ver todas las categor칤as</button>
                <div class="flex gap-2 overflow-x-auto pb-2">
                    <button onclick="filterRefacciones('sub-freno')" id="btn-sub-freno" class="sub-nav-btn px-4 py-2 bg-gray-200 text-gray-600 rounded-full font-bold text-sm uppercase transition hover:bg-gray-300"><i class="fas fa-hand-paper mr-2"></i> Frenos</button>
                    <button onclick="filterRefacciones('sub-electrico')" id="btn-sub-electrico" class="sub-nav-btn px-4 py-2 bg-gray-200 text-gray-600 rounded-full font-bold text-sm uppercase transition hover:bg-gray-300"><i class="fas fa-bolt mr-2"></i> El칠ctrico</button>
                    <button onclick="filterRefacciones('sub-chicote')" id="btn-sub-chicote" class="sub-nav-btn px-4 py-2 bg-gray-200 text-gray-600 rounded-full font-bold text-sm uppercase transition hover:bg-gray-300"><i class="fas fa-route mr-2"></i> Chicotes</button>
                </div>
            </div>
            
            <!-- MEN칔 VISUAL REFACCIONES -->
            <div id="refacciones-home" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div onclick="filterRefacciones('sub-freno')" class="cursor-pointer bg-white border border-gray-200 rounded-lg p-6 hover:shadow-xl hover:border-blue-800 transition flex items-center gap-4 group">
                    <div class="bg-red-100 p-4 rounded-full text-red-600 group-hover:bg-red-600 group-hover:text-white transition"><i class="fas fa-hand-paper text-3xl"></i></div>
                    <div><h3 class="font-bold text-xl text-[#0866bd]">Sistema de Frenos</h3><p class="text-sm text-gray-500">Balatas, Discos</p></div><i class="fas fa-chevron-right ml-auto text-gray-300"></i>
                </div>
                <div onclick="filterRefacciones('sub-electrico')" class="cursor-pointer bg-white border border-gray-200 rounded-lg p-6 hover:shadow-xl hover:border-blue-800 transition flex items-center gap-4 group">
                    <div class="bg-yellow-100 p-4 rounded-full text-yellow-600 group-hover:bg-yellow-500 group-hover:text-white transition"><i class="fas fa-bolt text-3xl"></i></div>
                    <div><h3 class="font-bold text-xl text-[#0866bd]">Sistema El칠ctrico</h3><p class="text-sm text-gray-500">Bater칤as, Relevadores</p></div><i class="fas fa-chevron-right ml-auto text-gray-300"></i>
                </div>
                <div onclick="filterRefacciones('sub-chicote')" class="cursor-pointer bg-white border border-gray-200 rounded-lg p-6 hover:shadow-xl hover:border-blue-800 transition flex items-center gap-4 group">
                    <div class="bg-gray-100 p-4 rounded-full text-gray-600 group-hover:bg-gray-700 group-hover:text-white transition"><i class="fas fa-route text-3xl"></i></div>
                    <div><h3 class="font-bold text-xl text-[#0866bd]">Chicotes y Cables</h3><p class="text-sm text-gray-500">Clutch, Acelerador</p></div><i class="fas fa-chevron-right ml-auto text-gray-300"></i>
                </div>
            </div>

            <!-- CONTENEDORES PARA SUB-CATEGOR칈AS -->
            <div id="grid-sub-freno" class="sub-category-grid hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"></div>
            <div id="grid-sub-electrico" class="sub-category-grid hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"></div>
            <div id="grid-sub-chicote" class="sub-category-grid hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"></div>
        </section>

        <section id="accesorios" class="product-section hidden-section">
            <div class="flex items-center mb-8 border-b pb-3 border-gray-300"><div class="h-6 md:h-8 w-1 bg-gray-700 mr-3"></div><h2 class="text-2xl md:text-3xl font-bold text-[#0866bd] oswald uppercase">Accesorios</h2></div>
            <div id="grid-accesorios" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"></div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer class="bg-[#0866bd] text-white pt-16 pb-8 border-t-4 border-yellow-500">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-10 text-center md:text-left">
            <div>
                <h4 class="oswald text-xl md:text-2xl uppercase mb-4 tracking-wider text-yellow-500">Moto Refacciones El Jefe</h4>
                <p class="text-gray-300 text-xs md:text-sm leading-relaxed text-justify mb-6">
                    En <b>Moto Partes El Jefe</b>, somos una gran familia dedicada a mantener tu pasi칩n en movimiento. Confianza y honestidad en Tonal치.
                </p>
                <div>
                    <h5 class="font-bold text-white uppercase mb-3 text-sm tracking-widest">S칤guenos:</h5>
                    <div class="flex gap-4 justify-center md:justify-start">
                        <a href="https://www.facebook.com/profile.php?id=61582551320267" class="w-10 h-10 rounded-full bg-[#1877F2] flex items-center justify-center text-white hover:scale-110 transition shadow-lg border-2 border-white/20 relative z-10"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.tiktok.com/@moto.partes.el.je" class="w-10 h-10 rounded-full bg-black flex items-center justify-center text-white hover:scale-110 transition shadow-lg border-2 border-white/20 relative z-10"><i class="fab fa-tiktok"></i></a>
                        <a href="https://www.instagram.com/el_jefe1949/" class="w-10 h-10 rounded-full bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 flex items-center justify-center text-white hover:scale-110 transition shadow-lg border-2 border-white/20 relative z-10"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div>
                <h4 class="oswald text-lg md:text-xl uppercase mb-6 tracking-wider text-yellow-500">Ubicaci칩n</h4>
                <a href="https://maps.google.com/?q=Marcos+Lara+60,+Tonal치,+Jalisco" target="_blank" class="block text-gray-300 mb-2 hover:text-white transition cursor-pointer group text-sm"><i class="fas fa-map-marker-alt mr-3 text-red-500"></i> Marcos Lara 60, Tonal치, Jal.</a>
                <a href="https://wa.me/523332406334" target="_blank" class="block text-gray-300 mb-4 hover:text-white transition cursor-pointer group text-sm"><i class="fas fa-phone mr-3 text-green-500"></i> 33 3240 6334</a>
                <div class="w-full h-40 rounded-lg overflow-hidden border-2 border-gray-400/50 shadow-lg mt-2">
                    <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://maps.google.com/maps?q=Calle+Marcos+Lara+60,+Santa+Paula,+Tonal치,+Jalisco&t=&z=15&ie=UTF8&iwloc=&output=embed" allowfullscreen></iframe>
                </div>
            </div>
            <div>
                <h4 class="oswald text-lg md:text-xl uppercase mb-6 tracking-wider text-yellow-500">Horario</h4>
                <p class="text-gray-300 mb-2 text-sm"><i class="far fa-clock mr-2 text-yellow-500"></i> Lunes a Viernes: 11:00 AM - 7:00 PM</p>
                <p class="text-gray-300 text-sm"><i class="far fa-clock mr-2 text-yellow-500"></i> S치bados: 11:00 AM - 4:00 PM</p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/523332406334" class="float-wa hover:rotate-12" target="_blank"><i class="fab fa-whatsapp"></i></a>

    <!-- MODAL -->
    <div id="modal-overlay" onclick="closeModal(event)">
        <div class="bg-white rounded-lg max-w-5xl w-full relative shadow-2xl overflow-hidden mx-auto flex flex-col md:flex-row max-h-[90vh] border-t-4 border-[#0866bd]">
            <button onclick="closeModal(event)" class="absolute top-3 right-3 bg-gray-100 rounded-full w-10 h-10 flex items-center justify-center text-gray-500 hover:text-red-600 hover:bg-gray-200 transition z-20"><i class="fas fa-times text-xl"></i></button>
            <div class="w-full md:w-1/2 bg-gray-50 flex items-center justify-center p-6 md:p-10 border-b md:border-b-0 md:border-r border-gray-200 relative">
                 <div id="modal-images" class="w-full h-64 md:h-full flex items-center justify-center text-gray-300"><i class="fas fa-camera text-7xl md:text-8xl"></i></div>
            </div>
            <div class="w-full md:w-1/2 p-6 md:p-8 overflow-y-auto relative flex flex-col">
                <div class="mb-6"><h2 id="modal-title" class="oswald text-3xl md:text-4xl font-bold text-[#0866bd] uppercase leading-tight mb-2"></h2><p id="modal-price" class="text-3xl md:text-4xl font-bold text-red-600"></p></div>
                <div class="mb-6"><h3 class="font-bold text-sm text-gray-700 uppercase mb-3 flex items-center tracking-wider"><i class="fas fa-box-open mr-2 text-[#0866bd]"></i> ESPECIFICACIONES:</h3><div id="modal-desc" class="modal-list ml-1"></div></div>
                <div id="modal-compat-container" class="compat-table-container hidden mb-6"><div class="compat-table-header"><i class="fas fa-motorcycle mr-2"></i> COMPATIBILIDAD</div><div class="compat-table-body"><table class="table-auto"><thead><tr><th>MODELO</th><th>DETALLES</th></tr></thead><tbody id="modal-compat-table-body"></tbody></table></div></div>
                <div class="mt-auto pt-4"><a id="modal-btn-wa" href="#" target="_blank" class="flex items-center justify-center w-full bg-green-600 text-white font-bold py-4 rounded-lg shadow-md hover:bg-green-700 transition uppercase tracking-widest text-lg"><i class="fab fa-whatsapp mr-3 text-2xl"></i> Pedir Ahora</a></div>
            </div>
        </div>
    </div>

    <!-- SCRIPT DE INTELIGENCIA -->
    <script>
        // --------------------------------------------------------------------------------------
        // 1. CONFIGURACI칍N DEL EXCEL DE GOOGLE
        // --------------------------------------------------------------------------------------
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQy95wWvKIo9bSznbkRWiT2EZ8XseAllbH4J-KsfwG6pGNJ_E2KMTnFFwvMLxH8GxV8whgg4T3n-Gxc/pub?output=csv"; 

        // --------------------------------------------------------------------------------------
        // 2. L칍GICA DEL CARRUSEL
        // --------------------------------------------------------------------------------------
        const slides = [
            { img: 'https://image2url.com/r2/default/images/1771179811792-f4258742-24cf-4aef-8034-9c696e3d446f.webp', title: 'ESPECIALISTAS EN MOTOS', text: 'Refacciones para Italika, Bajaj, Vento y m치s' },
            { img: 'https://image2url.com/r2/default/images/1771181317642-a2c6388f-c9d1-4b8c-b77e-84153873a0ab.webp', title: 'SEGURIDAD Y ESTILO', text: 'Equ칤pate con los mejores cascos certificados DOT' },
            { img: 'https://image2url.com/r2/default/images/1771180198846-a452a5b8-c3bc-424c-ab7d-0801aca926c8.jpg', title: 'TU PASI칍N EN MOVIMIENTO', text: 'Refacciones de calidad para el camino' }
        ];
        let currentSlide = 0;
        const bgElement = document.getElementById('carousel-bg');
        const titleElement = document.getElementById('carousel-title');
        const textElement = document.getElementById('carousel-text');

        function updateSlide() {
            bgElement.classList.add('opacity-50');
            titleElement.classList.add('opacity-0');
            textElement.classList.add('opacity-0');
            setTimeout(() => {
                currentSlide = (currentSlide + 1) % slides.length;
                bgElement.style.backgroundImage = `url('${slides[currentSlide].img}')`;
                titleElement.innerText = slides[currentSlide].title;
                textElement.innerText = slides[currentSlide].text;
                bgElement.classList.remove('opacity-50');
                titleElement.classList.remove('opacity-0');
                textElement.classList.remove('opacity-0');
            }, 500); 
        }
        setInterval(updateSlide, 5000);

        // --------------------------------------------------------------------------------------
        // 3. CARGAR PRODUCTOS DESDE GOOGLE SHEETS
        // --------------------------------------------------------------------------------------
        function initStore() {
            Papa.parse(SHEET_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    renderProducts(results.data);
                },
                error: function(err) {
                    console.error("Error al leer Excel:", err);
                }
            });
        }

        function renderProducts(products) {
            // Limpiar contenedores
            document.querySelectorAll('[id^="grid-"]').forEach(el => el.innerHTML = '');

            products.forEach(p => {
                // Validar que el producto tenga datos
                if(!p.NOMBRE || !p.PRECIO) return;

                // Determinar contenedor destino
                let targetId = `grid-${p.CATEGORIA}`;
                if (p.CATEGORIA === 'refacciones' && p.SUBCATEGORIA) {
                    targetId = `grid-${p.SUBCATEGORIA}`;
                }
                
                const container = document.getElementById(targetId);
                if(container) {
                    const cardHTML = createCardHTML(p);
                    container.insertAdjacentHTML('beforeend', cardHTML);
                }
            });
        }

        function createCardHTML(p) {
            // L칩gica de Stock
            let stockQty = parseInt(p.STOCK) || 0;
            let stockBadge = '';
            let btnClass = 'bg-[#0866bd] hover:bg-[#064d8f]';
            let btnText = 'Ver Detalles';
            let opacity = '';

            if (stockQty === 0) {
                stockBadge = '<div class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-10"><i class="fas fa-times-circle"></i> AGOTADO</div>';
                btnClass = 'bg-gray-500 cursor-not-allowed';
                btnText = 'Agotado';
                opacity = 'opacity-75 grayscale';
            } else if (stockQty < 3) {
                stockBadge = `<div class="absolute top-2 left-2 bg-yellow-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-10"><i class="fas fa-exclamation-triangle"></i> 춰Quedan ${stockQty}!</div>`;
            } else {
                stockBadge = '<div class="absolute top-2 left-2 bg-green-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-10"><i class="fas fa-check-circle"></i> DISPONIBLE</div>';
            }

            // Imagen por defecto
            let imgSrc = p.IMAGEN ? p.IMAGEN : 'logo.png';
            let imgClass = p.IMAGEN ? 'object-contain' : 'opacity-20 p-8';

            // Escapar comillas para evitar errores en el onclick
            const safeTitle = p.NOMBRE.replace(/'/g, "&apos;");
            const safeImg = p.IMAGEN ? p.IMAGEN : '';
            const encodedDesc = encodeURIComponent(p.DESCRIPCION || '');
            const encodedCompat = encodeURIComponent(p.COMPATIBILIDAD || '');

            return `
            <div class="product-card ${opacity}" onclick="openModalFromData('${safeTitle}', '${p.PRECIO}', '${safeImg}', '${encodedDesc}', '${encodedCompat}', ${stockQty})">
                <div class="relative mb-3">
                    ${stockBadge}
                    <div class="h-32 md:h-48 bg-white rounded flex items-center justify-center overflow-hidden border border-gray-100 p-2">
                        <img src="${imgSrc}" class="w-full h-full ${imgClass} hover:scale-110 transition-transform duration-300" alt="${p.NOMBRE}">
                    </div>
                </div>
                <div class="card-content-grow">
                    <div>
                        <h3 class="font-bold text-[#0866bd] line-clamp-2 leading-tight mb-1">${p.NOMBRE}</h3>
                    </div>
                    <div class="flex justify-between items-center mt-auto">
                        <span class="text-xl md:text-2xl font-bold text-red-600">$${p.PRECIO}</span>
                    </div>
                </div>
                <button class="w-full ${btnClass} text-white py-2 rounded font-bold uppercase text-xs transition">${btnText}</button>
            </div>
            `;
        }

        // 4. FUNCIONES DE UI Y MODAL
        function openModalFromData(title, price, image, encDesc, encCompat, stockQty) {
            document.getElementById('modal-title').innerText = title;
            
            let stockMsg = (stockQty === 0) ? '<span class="text-red-600 font-bold text-sm ml-4">Agotado</span>' : '<span class="text-green-600 font-bold text-sm ml-4">En Stock</span>';
            document.getElementById('modal-price').innerHTML = "$" + price + stockMsg;

            const imgContainer = document.getElementById('modal-images');
            imgContainer.innerHTML = (image) ? `<img src="${image}" class="w-full h-full object-contain">` : `<img src="logo.png" class="opacity-20 h-32 w-auto">`;

            document.getElementById('modal-desc').innerHTML = decodeURIComponent(encDesc);
            const compatBody = document.getElementById('modal-compat-table-body');
            const compatHTML = decodeURIComponent(encCompat);
            
            if (compatHTML) {
                compatBody.innerHTML = compatHTML;
                document.getElementById('modal-compat-container').classList.remove('hidden');
            } else {
                document.getElementById('modal-compat-container').classList.add('hidden');
            }

            document.getElementById('modal-btn-wa').href = `https://wa.me/523332406334?text=Hola,%20me%20interesa%20el%20${title}%20de%20$${price}`;
            document.getElementById('modal-overlay').classList.add('modal-active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(e) {
            if (e.target.id === 'modal-overlay' || e.target.closest('button')) {
                document.getElementById('modal-overlay').classList.remove('modal-active');
                document.body.style.overflow = 'auto';
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.product-section').forEach(s => {
                s.style.display = 'none'; s.classList.add('hidden-section');
            });
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).style.display = 'block';
            document.getElementById(tabId).classList.remove('hidden-section');
            document.getElementById('btn-' + tabId).classList.add('active');
        }

        function showRefaccionesHome() {
            document.getElementById('refacciones-home').classList.remove('hidden');
            document.querySelectorAll('.sub-category-grid').forEach(el => el.classList.add('hidden'));
            document.getElementById('btn-back-ref').classList.add('hidden');
            document.querySelectorAll('.sub-nav-btn').forEach(btn => {
                btn.classList.remove('bg-[#0866bd]', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-600');
            });
        }

        function filterRefacciones(subId) {
            document.getElementById('refacciones-home').classList.add('hidden');
            document.getElementById('btn-back-ref').classList.remove('hidden');
            document.querySelectorAll('.sub-category-grid').forEach(el => el.classList.add('hidden'));
            document.getElementById('grid-' + subId).classList.remove('hidden'); // ID del grid din치mico
            
            document.querySelectorAll('.sub-nav-btn').forEach(btn => {
                btn.classList.remove('bg-[#0866bd]', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-600');
            });
            document.getElementById('btn-' + subId).classList.remove('bg-gray-200', 'text-gray-600');
            document.getElementById('btn-' + subId).classList.add('bg-[#0866bd]', 'text-white');
        }

        function searchProducts() {
            let input = document.getElementById('globalSearch').value.toUpperCase();
            let cards = document.querySelectorAll('.product-card');
            
            if (input !== "") {
                document.querySelectorAll('.product-section').forEach(sec => {
                    sec.style.display = 'block'; sec.classList.remove('hidden-section');
                });
                document.getElementById('refacciones-home').classList.add('hidden');
                document.querySelectorAll('.sub-category-grid').forEach(grid => grid.classList.remove('hidden'));

                cards.forEach(card => {
                    let text = card.innerText;
                    card.style.display = (text.toUpperCase().indexOf(input) > -1) ? "flex" : "none";
                });
            } else {
                let activeBtn = document.querySelector('.nav-btn.active');
                if (activeBtn) switchTab(activeBtn.id.replace('btn-', ''));
            }
        }

        // INICIAR
        document.addEventListener('DOMContentLoaded', () => {
            initStore(); // Cargar Excel
        });
    </script>
</body>
</html>